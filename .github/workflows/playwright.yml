name: Playwright Tests

on:
  workflow_dispatch:
  #schedule:
  #  - cron: '0 1 * * *'

jobs:
  test_RyhmesWorldWide:
    timeout-minutes: 60
    environment: RyhmesWorldWide
    runs-on: ubuntu-latest
    env:
      GHOST_LAB_URL: ${{ secrets.GHOST_LAB_URL }}
      GHOST_LAB_USERNAME: ${{ secrets.GHOST_LAB_USERNAME }}
      GHOST_LAB_PASSWORD: ${{ secrets.GHOST_LAB_PASSWORD }}
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 16
    - run: npm install
    - run: npx playwright install --with-deps
    - name: Run Backup Script
      run: |
        mkdir -p artifacts

        # Run tests with trace capture only on failure
        npx playwright test --trace retain-on-failure

    # Upload trace files and downloads on failure
    - name: Upload Trace and Downloads
      uses: actions/upload-artifact@v3
      with:
        name: playwright-artifacts
        path: |
          downloads/
          artifacts/
          test-results/**/*.zip
        retention-days: 30

  test_BestQuestGames:
    timeout-minutes: 60
    environment: BestQuestGames
    runs-on: ubuntu-latest
    env:
      GHOST_LAB_URL: ${{ secrets.GHOST_LAB_URL }}
      GHOST_LAB_USERNAME: ${{ secrets.GHOST_LAB_USERNAME }}
      GHOST_LAB_PASSWORD: ${{ secrets.GHOST_LAB_PASSWORD }}
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 16
    - run: npm install
    - run: npx playwright install --with-deps
    - name: Run Backup Script
      run: |
        mkdir -p artifacts

        # Run tests with trace capture only on failure
        npx playwright test --trace retain-on-failure

    # Upload trace files and downloads on failure
    - name: Upload Trace and Downloads
      uses: actions/upload-artifact@v3
      with:
        name: playwright-artifacts
        path: |
          artifacts/
          downloads/
          test-results/**/*.zip
        retention-days: 30
